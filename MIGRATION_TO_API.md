# –ü–µ—Ä–µ—Ö–æ–¥ –Ω–∞ PostgreSQL API - –ó–∞–≤–µ—Ä—à–µ–Ω–æ ‚úÖ

## –ß—Ç–æ –±—ã–ª–æ —Å–¥–µ–ª–∞–Ω–æ:

### 1. **API Endpoints –¥–ª—è –≤–æ–ø—Ä–æ—Å–æ–≤** (`routes/questions.js`)

–°–æ–∑–¥–∞–Ω –ø–æ–ª–Ω—ã–π REST API –¥–ª—è —Ä–∞–±–æ—Ç—ã —Å –≤–æ–ø—Ä–æ—Å–∞–º–∏ –∏–∑ PostgreSQL:

#### –û—Å–Ω–æ–≤–Ω—ã–µ endpoints:

- **GET /api/questions/:id** - –ü–æ–ª—É—á–∏—Ç—å –≤–æ–ø—Ä–æ—Å –ø–æ ID —Å–æ –≤—Å–µ–º–∏ –ø–µ—Ä–µ–≤–æ–¥–∞–º–∏
- **GET /api/questions/batch?ids=1,2,3&lang=uz** - –ü–æ–ª—É—á–∏—Ç—å –Ω–µ—Å–∫–æ–ª—å–∫–æ –≤–æ–ø—Ä–æ—Å–æ–≤ —Å—Ä–∞–∑—É
- **GET /api/questions/random/:count?lang=uz** - –°–ª—É—á–∞–π–Ω—ã–µ –≤–æ–ø—Ä–æ—Å—ã –¥–ª—è —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è
- **GET /api/questions/lang/:lang?limit=10&offset=0** - –í—Å–µ –≤–æ–ø—Ä–æ—Å—ã –Ω–∞ —è–∑—ã–∫–µ —Å –ø–∞–≥–∏–Ω–∞—Ü–∏–µ–π
- **POST /api/questions/stats/:id** - –û–±–Ω–æ–≤–∏—Ç—å —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫—É –≤–æ–ø—Ä–æ—Å–∞
- **GET /api/questions/stats/difficult?limit=20&lang=uz** - –°–∞–º—ã–µ —Å–ª–æ–∂–Ω—ã–µ –≤–æ–ø—Ä–æ—Å—ã

### 2. **–û–±–Ω–æ–≤–ª–µ–Ω–Ω—ã–π ticket-loader.js**

–ü–æ–ª–Ω–æ—Å—Ç—å—é –ø–µ—Ä–µ–ø–∏—Å–∞–Ω –¥–ª—è —Ä–∞–±–æ—Ç—ã —Å API –≤–º–µ—Å—Ç–æ —Ñ–∞–π–ª–æ–≤–æ–π —Å–∏—Å—Ç–µ–º—ã:

```javascript
// –°—Ç–∞—Ä–∞—è –≤–µ—Ä—Å–∏—è (—Ñ–∞–π–ª—ã):
await fetch('data/questions/q0001.json')

// –ù–æ–≤–∞—è –≤–µ—Ä—Å–∏—è (API):
await fetch('/api/questions/1')
await fetch('/api/questions/batch?ids=1,2,3,4,5,6,7,8,9,10&lang=uz')
```

#### –ö–ª—é—á–µ–≤—ã–µ –∏–∑–º–µ–Ω–µ–Ω–∏—è:

- ‚úÖ `loadQuestion(id)` - —á–µ—Ä–µ–∑ API –≤–º–µ—Å—Ç–æ JSON —Ñ–∞–π–ª–æ–≤
- ‚úÖ `loadTicket(number)` - –≥–µ–Ω–µ—Ä–∏—Ä—É–µ—Ç –±–∏–ª–µ—Ç –¥–µ—Ç–µ—Ä–º–∏–Ω–∏—Ä–æ–≤–∞–Ω–Ω–æ –∏–∑ 10 –≤–æ–ø—Ä–æ—Å–æ–≤
- ‚úÖ `loadRandomQuestions(count)` - —á–µ—Ä–µ–∑ `/random` endpoint
- ‚úÖ `generateTicketQuestionIds()` - –¥–µ—Ç–µ—Ä–º–∏–Ω–∏—Ä–æ–≤–∞–Ω–Ω–∞—è –≥–µ–Ω–µ—Ä–∞—Ü–∏—è ID –¥–ª—è –±–∏–ª–µ—Ç–æ–≤
- ‚úÖ `updateQuestionStats()` - –æ—Ç–ø—Ä–∞–≤–∫–∞ —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∏ –≤ –ë–î
- ‚úÖ `getTicketsCount()` - –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç 113 –±–∏–ª–µ—Ç–æ–≤ (1130 / 10)

### 3. **–û–±–Ω–æ–≤–ª–µ–Ω server.js**

- –î–æ–±–∞–≤–ª–µ–Ω import `questionsRoutes`
- –ü–æ–¥–∫–ª—é—á–µ–Ω —Ä–æ—É—Ç: `app.use('/api/questions', questionsRoutes)`
- –û–±–Ω–æ–≤–ª–µ–Ω CSP –¥–ª—è Cloudflare R2: `imgSrc` –≤–∫–ª—é—á–∞–µ—Ç R2 URL

### 4. **–ë–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö –≥–æ—Ç–æ–≤–∞**

```
üìä PostgreSQL Database:
   - –í–æ–ø—Ä–æ—Å–æ–≤: 1130
   - –ü–µ—Ä–µ–≤–æ–¥–æ–≤: 3390 (uz, ru, uzk)
   - –í–∞—Ä–∏–∞–Ω—Ç–æ–≤ –æ—Ç–≤–µ—Ç–æ–≤: 11050
   - –ò–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è: Cloudflare R2
   - –ë–∏–ª–µ—Ç—ã: –ì–µ–Ω–µ—Ä–∏—Ä—É—é—Ç—Å—è –¥–∏–Ω–∞–º–∏—á–µ—Å–∫–∏
```

---

## –ö–∞–∫ —Ä–∞–±–æ—Ç–∞–µ—Ç –≥–µ–Ω–µ—Ä–∞—Ü–∏—è –±–∏–ª–µ—Ç–æ–≤:

### –î–µ—Ç–µ—Ä–º–∏–Ω–∏—Ä–æ–≤–∞–Ω–Ω—ã–π –∞–ª–≥–æ—Ä–∏—Ç–º:

```javascript
// –ë–∏–ª–µ—Ç 1: –≤–æ–ø—Ä–æ—Å—ã 1-10
// –ë–∏–ª–µ—Ç 2: –≤–æ–ø—Ä–æ—Å—ã 11-20
// –ë–∏–ª–µ—Ç 3: –≤–æ–ø—Ä–æ—Å—ã 21-30
// ...
// –ë–∏–ª–µ—Ç 113: –≤–æ–ø—Ä–æ—Å—ã 1121-1130

function generateTicketQuestionIds(ticketNumber) {
    const startId = ((ticketNumber - 1) * 10) % 1130;
    // –í–æ–∑–≤—Ä–∞—â–∞–µ—Ç –º–∞—Å—Å–∏–≤ –∏–∑ 10 –ø–æ—Å–ª–µ–¥–æ–≤–∞—Ç–µ–ª—å–Ω—ã—Ö ID
}
```

### –ö–æ–ª–∏—á–µ—Å—Ç–≤–æ –±–∏–ª–µ—Ç–æ–≤: **113**
- 1130 –≤–æ–ø—Ä–æ—Å–æ–≤ √∑ 10 –≤–æ–ø—Ä–æ—Å–æ–≤ –Ω–∞ –±–∏–ª–µ—Ç = 113 –±–∏–ª–µ—Ç–æ–≤
- –ö–∞–∂–¥—ã–π –±–∏–ª–µ—Ç –≤—Å–µ–≥–¥–∞ —Å–æ–¥–µ—Ä–∂–∏—Ç –æ–¥–Ω–∏ –∏ —Ç–µ –∂–µ –≤–æ–ø—Ä–æ—Å—ã
- –ë–∏–ª–µ—Ç—ã –Ω–µ —Ö—Ä–∞–Ω—è—Ç—Å—è –≤ –ë–î, –≥–µ–Ω–µ—Ä–∏—Ä—É—é—Ç—Å—è –Ω–∞ –ª–µ—Ç—É

---

## –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ API:

### 1. –ó–∞–ø—É—Å—Ç–∏—Ç—å —Å–µ—Ä–≤–µ—Ä:
```bash
node server.js
```

### 2. –¢–µ—Å—Ç–æ–≤—ã–µ –∑–∞–ø—Ä–æ—Å—ã:

```bash
# –ü–æ–ª—É—á–∏—Ç—å –≤–æ–ø—Ä–æ—Å 1
curl http://localhost:3000/api/questions/1

# –ü–æ–ª—É—á–∏—Ç—å –±–∏–ª–µ—Ç (10 –≤–æ–ø—Ä–æ—Å–æ–≤)
curl "http://localhost:3000/api/questions/batch?ids=1,2,3,4,5,6,7,8,9,10&lang=uz"

# –°–ª—É—á–∞–π–Ω—ã–µ 20 –≤–æ–ø—Ä–æ—Å–æ–≤
curl "http://localhost:3000/api/questions/random/20?lang=ru"

# –û–±–Ω–æ–≤–∏—Ç—å —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫—É
curl -X POST http://localhost:3000/api/questions/stats/1 \
  -H "Content-Type: application/json" \
  -d '{"correct": true, "timeSeconds": 15}'
```

---

## –§–æ—Ä–º–∞—Ç –æ—Ç–≤–µ—Ç–∞ API:

### –ü–æ–ª–Ω—ã–π –≤–æ–ø—Ä–æ—Å (/api/questions/:id):
```json
{
  "question_id": 1,
  "image_url": "https://pub-eb6a742d1f3d48568bcc6d3c14150eaf.r2.dev/q0001.webp",
  "correct_answer": 4,
  "difficulty_level": 1,
  "category": null,
  "translations": {
    "uz": {
      "text": "Qaysi avtomobil...",
      "explanation": "YHQ 1-ilovasi...",
      "options": ["Qizilga", "Ikkala...", "Hech...", "Sariq..."]
    },
    "ru": { ... },
    "uzk": { ... }
  }
}
```

### –í–æ–ø—Ä–æ—Å –Ω–∞ —è–∑—ã–∫–µ (/batch, /random):
```json
{
  "questions": [
    {
      "id": 1,
      "question_id": 1,
      "image_url": "https://...",
      "correct_answer": 4,
      "question_text": "Qaysi avtomobil...",
      "explanation": "YHQ 1-ilovasi...",
      "options": ["Qizilga", "Ikkala...", ...]
    }
  ],
  "count": 10
}
```

---

## –°–ª–µ–¥—É—é—â–∏–µ —à–∞–≥–∏:

### 1. –û–±–Ω–æ–≤–∏—Ç—å dashboard.js
- ‚úÖ `ticket-loader.js` —É–∂–µ –æ–±–Ω–æ–≤–ª–µ–Ω
- ‚è≥ –ü—Ä–æ–≤–µ—Ä–∏—Ç—å —Å–æ–≤–º–µ—Å—Ç–∏–º–æ—Å—Ç—å —Å dashboard.js
- ‚è≥ –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å–∞ –±–∏–ª–µ—Ç–æ–≤

### 2. –û–±–Ω–æ–≤–∏—Ç—å test.html / test.js
- –ï—Å–ª–∏ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –¥–ª—è –ø—Ä–æ—Ö–æ–∂–¥–µ–Ω–∏—è —Ç–µ—Å—Ç–æ–≤
- –ü—Ä–æ–≤–µ—Ä–∏—Ç—å getQuestionData() –º–µ—Ç–æ–¥

### 3. –î–µ–ø–ª–æ–π –Ω–∞ Railway
```bash
# 1. –°–æ–∑–¥–∞—Ç—å PostgreSQL –Ω–∞ Railway
# 2. –°–∫–æ–ø–∏—Ä–æ–≤–∞—Ç—å DATABASE_URL
# 3. –î–æ–±–∞–≤–∏—Ç—å –≤ Railway environment variables:
#    - POSTGRES_HOST, POSTGRES_PORT, POSTGRES_DB
#    - POSTGRES_USER, POSTGRES_PASSWORD
#    - R2_BASE_URL
# 4. –ó–∞–ø—É—Å—Ç–∏—Ç—å import-questions.js –Ω–∞ Railway
# 5. –ó–∞–¥–µ–ø–ª–æ–∏—Ç—å server.js
```

### 4. –ü—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å
- Connection pooling —É–∂–µ –Ω–∞—Å—Ç—Ä–æ–µ–Ω (max 20)
- –ò–Ω–¥–µ–∫—Å—ã —Å–æ–∑–¥–∞–Ω—ã –≤ –ë–î
- –ö–µ—à –≤ ticket-loader.js —Ä–∞–±–æ—Ç–∞–µ—Ç

---

## –ü—Ä–æ–≤–µ—Ä–∫–∞ —Ä–∞–±–æ—Ç—ã:

### –õ–æ–∫–∞–ª—å–Ω–æ:
1. ‚úÖ PostgreSQL –∑–∞–ø—É—â–µ–Ω (Docker)
2. ‚úÖ 1130 –≤–æ–ø—Ä–æ—Å–æ–≤ –∏–º–ø–æ—Ä—Ç–∏—Ä–æ–≤–∞–Ω—ã
3. ‚úÖ –°–µ—Ä–≤–µ—Ä –∑–∞–ø—É—â–µ–Ω (–ø–æ—Ä—Ç 3000)
4. ‚úÖ API endpoints —Ä–∞–±–æ—Ç–∞—é—Ç
5. ‚è≥ Frontend –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è (—Ç–µ—Å—Ç–∏—Ä–æ–≤–∞—Ç—å)

### –û—Ç–∫—Ä–æ–π—Ç–µ:
```
http://localhost:3000/dashboard.html
```

Dashboard –¥–æ–ª–∂–µ–Ω:
- –ü–æ–∫–∞–∑–∞—Ç—å 113 –±–∏–ª–µ—Ç–æ–≤ (–≤–º–µ—Å—Ç–æ 118)
- –ó–∞–≥—Ä—É–∂–∞—Ç—å –≤–æ–ø—Ä–æ—Å—ã —á–µ—Ä–µ–∑ API
- –†–∞–±–æ—Ç–∞—Ç—å —Å–æ –≤—Å–µ–º–∏ —è–∑—ã–∫–∞–º–∏ (uz, ru, uzk)
- –ü–æ–∫–∞–∑—ã–≤–∞—Ç—å –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è –∏–∑ R2

---

## –ú–∏–≥—Ä–∞—Ü–∏—è –∑–∞–≤–µ—Ä—à–µ–Ω–∞! üéâ

–°—Ç–∞—Ä–∞—è —Ñ–∞–π–ª–æ–≤–∞—è —Å–∏—Å—Ç–µ–º–∞ (`data/questions/*.json`) –±–æ–ª—å—à–µ –Ω–µ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è.
–í—Å–µ –¥–∞–Ω–Ω—ã–µ —Ç–µ–ø–µ—Ä—å –≤ PostgreSQL —Å –¥–æ—Å—Ç—É–ø–æ–º —á–µ—Ä–µ–∑ REST API.
