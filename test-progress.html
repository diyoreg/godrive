<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Test Progress API</title>
    <style>
        body {
            font-family: monospace;
            padding: 20px;
            background: #1e293b;
            color: #e2e8f0;
        }
        button {
            padding: 10px 20px;
            margin: 10px;
            cursor: pointer;
            background: #3b82f6;
            color: white;
            border: none;
            border-radius: 5px;
        }
        pre {
            background: #0f172a;
            padding: 20px;
            border-radius: 10px;
            overflow-x: auto;
        }
        .success { color: #10b981; }
        .error { color: #ef4444; }
    </style>
</head>
<body>
    <h1>Test Progress API</h1>
    
    <div>
        <button id="btnGetProgress">1. GET /api/progress</button>
        <button id="btnSaveProgress">2. POST /api/progress/ticket/1</button>
        <button id="btnGetTicketProgress">3. GET /api/progress/ticket/1</button>
        <button id="btnClear">Clear</button>
    </div>
    
    <pre id="output"></pre>
    
    <script>
        const output = document.getElementById('output');
        
        function log(message, type = 'info') {
            const timestamp = new Date().toLocaleTimeString();
            const className = type === 'error' ? 'error' : type === 'success' ? 'success' : '';
            output.innerHTML += `<span class="${className}">[${timestamp}] ${message}</span>\n`;
        }
        
        function clearOutput() {
            output.innerHTML = '';
        }
        
        async function testGetProgress() {
            log('üìä –¢–µ—Å—Ç–∏—Ä—É–µ–º GET /api/progress...');
            
            const token = localStorage.getItem('authToken');
            if (!token) {
                log('‚ùå –ù–µ—Ç —Ç–æ–∫–µ–Ω–∞ –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏! –ü–æ–∂–∞–ª—É–π—Å—Ç–∞, –≤–æ–π–¥–∏—Ç–µ –≤ —Å–∏—Å—Ç–µ–º—É.', 'error');
                return;
            }
            
            try {
                const response = await fetch('/api/progress', {
                    method: 'GET',
                    headers: {
                        'Authorization': `Bearer ${token}`,
                        'Content-Type': 'application/json'
                    }
                });
                
                const data = await response.json();
                
                if (response.ok) {
                    log('‚úÖ –ü—Ä–æ–≥—Ä–µ—Å—Å —É—Å–ø–µ—à–Ω–æ –ø–æ–ª—É—á–µ–Ω:', 'success');
                    log(JSON.stringify(data, null, 2));
                } else {
                    log(`‚ùå –û—à–∏–±–∫–∞: ${response.status}`, 'error');
                    log(JSON.stringify(data, null, 2), 'error');
                }
            } catch (error) {
                log(`‚ùå –û—à–∏–±–∫–∞ —Å–µ—Ç–∏: ${error.message}`, 'error');
            }
        }
        
        async function testSaveProgress() {
            log('üíæ –¢–µ—Å—Ç–∏—Ä—É–µ–º POST /api/progress/ticket/1...');
            
            const token = localStorage.getItem('authToken');
            if (!token) {
                log('‚ùå –ù–µ—Ç —Ç–æ–∫–µ–Ω–∞ –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏!', 'error');
                return;
            }
            
            const progressData = {
                completed: true,
                score: 8,
                totalQuestions: 10,
                answers: {
                    '1': { selected: 2, correct: 2, isCorrect: true, timestamp: new Date().toISOString() },
                    '2': { selected: 1, correct: 3, isCorrect: false, timestamp: new Date().toISOString() },
                    '3': { selected: 4, correct: 4, isCorrect: true, timestamp: new Date().toISOString() },
                    '4': { selected: 2, correct: 2, isCorrect: true, timestamp: new Date().toISOString() },
                    '5': { selected: 3, correct: 3, isCorrect: true, timestamp: new Date().toISOString() },
                    '6': { selected: 1, correct: 2, isCorrect: false, timestamp: new Date().toISOString() },
                    '7': { selected: 3, correct: 3, isCorrect: true, timestamp: new Date().toISOString() },
                    '8': { selected: 4, correct: 4, isCorrect: true, timestamp: new Date().toISOString() },
                    '9': { selected: 2, correct: 2, isCorrect: true, timestamp: new Date().toISOString() },
                    '10': { selected: 1, correct: 1, isCorrect: true, timestamp: new Date().toISOString() }
                },
                stats: {
                    correct: 8,
                    incorrect: 2,
                    unanswered: 0,
                    percentage: 80
                }
            };
            
            try {
                const response = await fetch('/api/progress/ticket/1', {
                    method: 'POST',
                    headers: {
                        'Authorization': `Bearer ${token}`,
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify(progressData)
                });
                
                const data = await response.json();
                
                if (response.ok) {
                    log('‚úÖ –ü—Ä–æ–≥—Ä–µ—Å—Å —É—Å–ø–µ—à–Ω–æ —Å–æ—Ö—Ä–∞–Ω–µ–Ω:', 'success');
                    log(JSON.stringify(data, null, 2));
                } else {
                    log(`‚ùå –û—à–∏–±–∫–∞: ${response.status}`, 'error');
                    log(JSON.stringify(data, null, 2), 'error');
                }
            } catch (error) {
                log(`‚ùå –û—à–∏–±–∫–∞ —Å–µ—Ç–∏: ${error.message}`, 'error');
            }
        }
        
        async function testGetTicketProgress() {
            log('üìã –¢–µ—Å—Ç–∏—Ä—É–µ–º GET /api/progress/ticket/1...');
            
            const token = localStorage.getItem('authToken');
            if (!token) {
                log('‚ùå –ù–µ—Ç —Ç–æ–∫–µ–Ω–∞ –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏!', 'error');
                return;
            }
            
            try {
                const response = await fetch('/api/progress/ticket/1', {
                    method: 'GET',
                    headers: {
                        'Authorization': `Bearer ${token}`,
                        'Content-Type': 'application/json'
                    }
                });
                
                const data = await response.json();
                
                if (response.ok) {
                    log('‚úÖ –ü—Ä–æ–≥—Ä–µ—Å—Å –±–∏–ª–µ—Ç–∞ –ø–æ–ª—É—á–µ–Ω:', 'success');
                    log(JSON.stringify(data, null, 2));
                } else {
                    log(`‚ùå –û—à–∏–±–∫–∞: ${response.status}`, 'error');
                    log(JSON.stringify(data, null, 2), 'error');
                }
            } catch (error) {
                log(`‚ùå –û—à–∏–±–∫–∞ —Å–µ—Ç–∏: ${error.message}`, 'error');
            }
        }
        
        // –ü—Ä–æ–≤–µ—Ä—è–µ–º –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏—é –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ
        window.addEventListener('load', () => {
            const token = localStorage.getItem('authToken');
            if (token) {
                log('‚úÖ –¢–æ–∫–µ–Ω –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏ –Ω–∞–π–¥–µ–Ω', 'success');
            } else {
                log('‚ö†Ô∏è –¢–æ–∫–µ–Ω –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏ –Ω–µ –Ω–∞–π–¥–µ–Ω. –í–æ–π–¥–∏—Ç–µ —á–µ—Ä–µ–∑ login.html', 'error');
            }
            
            // –î–æ–±–∞–≤–ª—è–µ–º –æ–±—Ä–∞–±–æ—Ç—á–∏–∫–∏ —Å–æ–±—ã—Ç–∏–π
            document.getElementById('btnGetProgress').addEventListener('click', testGetProgress);
            document.getElementById('btnSaveProgress').addEventListener('click', testSaveProgress);
            document.getElementById('btnGetTicketProgress').addEventListener('click', testGetTicketProgress);
            document.getElementById('btnClear').addEventListener('click', clearOutput);
        });
    </script>
</body>
</html>
